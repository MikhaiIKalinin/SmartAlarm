name: Build and Release Application
run-name: Build & Release triggered by ${{ github.actor }}

# Тригер: Запуск при будь-якому пуші в гілку main
on:
  push:
    branches: [ "main" ]

# Дозвіл на створення релізів
permissions:
  contents: write

jobs:
  build-and-release:
    name: Build & Release
    runs-on: ubuntu-latest
    
    steps:
      # 1. Завантаження коду
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Вивід інформації про автора (як у завданні)
      - name: Display Author Info
        run: |
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
          echo "Автор змін: ${{ github.actor }}"
          echo "Подія: ${{ github.event_name }}"
          echo "Гілка: ${{ github.ref }}"
          echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

      # 3. Налаштування Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # 4. Процес збірки (Встановлення бібліотек + архівування)
      - name: Build Application
        run: |
          echo "Installing dependencies..."
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          
          echo "Creating build artifact..."
          # Створюємо архів з усіма файлами, крім системних папок git та налаштувань
          zip -r kpi_bot_release.zip . -x ".git/*" ".github/*" "__pycache__/*" "*.DS_Store"

      # 5. Створення релізу в GitHub
      - name: Create Release and Upload Asset
        uses: softprops/action-gh-release@v1
        with:
          # Автоматично створюємо тег на основі номера запуску (v1.0.1, v1.0.2...)
          tag_name: v1.0.${{ github.run_number }}
          name: Release v1.0.${{ github.run_number }}
          files: kpi_bot_release.zip
          body: |
            Автоматичний реліз від ${{ github.actor }}
            Версія збірки: v1.0.${{ github.run_number }}
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}